<script setup>
import {defineProps, onMounted, ref} from "vue";
import useFlagStore from '@/store/flagStore.js'
import router from "@/router/index.js";
import {ElMessageBox, ElNotification} from "element-plus";
import {aFollowUser, aGetUserFans, aIfMy, aUserUnfollowFan} from "@/api/api.js";

const flagStore = useFlagStore();
const {user_ID} = defineProps(['user_ID']);
const userID = user_ID;
let fansExist = ref(true)
let fansList = ref([{
  fan_ID: '',
  fan_avatar: '',
  fan_name: '',
  fan_introduction: '',
  feo: 0,
}])
let ifMyFlag = ref(false)

onMounted(() => {
  getUserFans(userID)
  ifMy(userID)
})

const toUserDetail = (user_ID) => {
  if (ifMyFlag) {
    router.push({
      path: '/myInfo',
    })
  } else {
    router.push({
      path: '/userDetail',
      query: {user_ID}
    })
  }
}

function ifMy(user_ID) {
  aIfMy(user_ID).then(resp => {
    ifMyFlag.value = resp.data.data
  })
}

function getUserFans(userID) {
  aGetUserFans(userID).then(resp => {
    if (resp.data.code === 200) {
      fansList.value = resp.data.data
    } else {
      fansExist.value = false
    }
  })
}

function followUser(fan_id) {
  aFollowUser(fan_id).then(resp => {
    if (resp.data.code === 200) {
      ElNotification({
        title: "关注成功！",
        type: 'success',
        duration: 2000,
      })
      getUserFans(userID)
    } else {
      console.log(resp.data.msg)
    }
  })
}

function unFollowUser(fan_id) {
  ElMessageBox.confirm('确认取消关注该好友吗？', {
    confirmButtonText: '仍然取消',
    cancelButtonText: '继续关注',
    type: 'warning',
  }).then(_ => {
    aUserUnfollowFan(fan_id).then(resp => {
      if (resp.data.code === 200) {
        ElNotification({
          title: "已取关！",
          type: 'success',
          duration: 2000,
        })
        getUserFans(userID)
      } else {
        console.log(resp.data.msg)
      }
    })
  }).catch(_ => {
  });
}
</script>

<template>
  <div id="fansFM">
    <el-dialog
        v-model="flagStore.flag"
        title="TA的粉丝"
        width="500"
        class="fansFMDia"
    >
      <el-scrollbar max-height="700px" noresize>
        <div class="fanList" v-if="fansExist" @click="toUserDetail(item.fan_ID)" v-for="item in fansList">
          <div class="fAvatar">
            <img :src="item.fan_avatar">
          </div>
          <div class="fNameAndfIntro">
            <span style="font-size: 18px">{{ item.fan_name }}</span>
            <span class="fIntro">{{ item.fan_introduction }}</span>
          </div>
          <div id="followBT" v-if="ifMyFlag">
            <el-button type="danger" plain round @click.stop="followUser(item.fan_ID)" v-if="item.feo===0">+ 关注
            </el-button>
            <el-button type="danger" plain round @click.stop="unFollowUser(item.fan_ID)" v-if="item.feo===1">
              <el-icon>
                <Check/>
              </el-icon>
              已关注
            </el-button>
          </div>
          <div class="noFollowBT" v-if="!ifMyFlag">
          </div>
        </div>
        <div class="noFan" v-if="!fansExist">
          <svg t="1717071259157" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
               p-id="11763" width="200" height="200">
            <path
                d="M833.442 360.291c-2.036 21.035-7.869 41.583-17.774 60.319l-0.436 0.779-27.165 42.249-6.786 10.558 11.386 4.901c12.136 5.221 23.982 12.377 35.304 20.902 11.924 8.997 23.412 19.672 34.151 31.324 11.887 12.913 22.736 26.893 32.229 41.088 10.165 15.213 18.905 30.793 25.822 45.672 25.887 55.699 26.53 106.871 25.761 168.509h0.09l-0.212 9.763h0.036v1.778l-0.102 0.285c-0.212 4.593-1.119 8.594-2.516 11.928-1.877 4.475-4.702 7.996-8.073 10.52l0.013 0.013a25.2 25.2 0 0 1-5.952 3.313h-0.044a28.04 28.04 0 0 1-6.534 1.714 29.786 29.786 0 0 1-6.733 0.122h-0.086a30.023 30.023 0 0 1-6.672-1.457l-12.616-4.36 1.853-2.85a25.19 25.19 0 0 1-5.337-9.688c-1.144-3.855-1.567-9.021-1.612-15.181-0.045-5.483 0.175-11.684 0.42-18.511h-0.029v-0.021l0.041-0.37c1.315-36.24 3.184-88.291-29.074-149.917a224.437 224.437 0 0 0-20.729-32.458 227.362 227.362 0 0 0-26.083-28.594 235.645 235.645 0 0 0-30.788-24.08c-11.102-7.291-22.892-13.735-35.193-19.276l-2.716-1.221-3.272-1.364a255.893 255.893 0 0 0-6.836-2.597 333.327 333.327 0 0 0-6.753-2.382h-0.041l-1.168-0.391-5.154-1.606c-1.592-0.497-3.403-1-5.288-1.494l-0.045-0.043c-1.27-0.332-2.642-0.659-3.998-0.975-2.092-0.485-4.038-0.949-6.159-1.669l-0.012 0.037c-2.528-0.859-4.865-2.009-7.039-3.745-2.508-2.015-4.612-4.555-6.188-7.387l-0.013 0.006c-1.53-2.748-2.605-5.862-3.139-9.135v-0.08c-0.505-3.255-0.443-6.717 0.249-10.226v-0.043a31.675 31.675 0 0 1 3.61-9.51l0.009 0.006c1.225-2.099 3.871-4.38 7.453-6.886h0.041c3.127-2.178 6.277-4.271 9.596-6.455 14.187-9.383 32.083-21.211 45.606-39.393 13.332-17.938 22.928-42.684 21.479-78.718-0.48-12.046-2.785-23.638-6.497-34.493-3.966-11.562-9.575-22.276-16.325-31.859-7.156-10.151-15.641-19.101-24.877-26.5-9.388-7.521-19.635-13.516-30.125-17.648l0.004-0.012a100.937 100.937 0 0 0-5.142-1.84l-4.665-1.476c-1.959-0.601-3.758-1.168-5.729-1.979-2.328-0.963-4.47-2.147-6.456-3.798l-0.041-0.037c-3.847-3.196-6.644-7.444-8.301-12.095l-0.012 0.006c-1.669-4.665-2.198-9.831-1.531-14.763h0.004a26.963 26.963 0 0 1 1.527-5.997l-0.013-0.01a22.994 22.994 0 0 1 3.09-5.663 20.972 20.972 0 0 1 4.816-4.641c1.637-1.132 3.554-2.111 5.72-2.868 7.796-2.728 18.205-2.674 31.362 1.659 10.32 3.399 22.712 9.54 37.286 19.182 18.241 12.095 33.683 27.597 45.952 45.22 12.767 18.325 22.143 38.975 27.78 60.488 5.598 21.399 7.504 43.688 5.391 65.421zM145.405 877.55l618.355-0.509 9.277-0.005 1.213-8.883c1.413-10.393 1.959-21.376 1.796-32.519-0.175-12.258-1.214-24.813-2.85-37.106-1.755-13.275-4.332-26.555-7.356-39.065-3.225-13.377-6.986-25.708-10.825-36.064l0.037-0.012c-11.049-29.727-26.827-57.213-46.348-81.696-20.005-25.109-43.926-47.084-70.668-65.106-26.632-17.957-56.212-32.115-87.659-41.687-30.614-9.322-62.896-14.297-95.829-14.228-22.233 0.04-44.625 2.52-66.562 7.091a345.42 345.42 0 0 0-64.901 20.416c-20.86 8.92-40.596 19.846-58.516 32.417-17.607 12.355-33.478 26.307-46.938 41.52-6.739 7.597-13.123 15.141-19.196 22.911-5.954 7.604-11.525 15.319-16.718 23.384a280.098 280.098 0 0 0-14.871 25.977c-4.635 9.229-9.021 19.183-13.175 30.121-3.511 9.241-7.086 21.287-10.237 34.746-3.002 12.844-5.628 26.855-7.454 40.855v0.041c-1.653 12.714-2.724 25.61-2.905 37.855-0.153 10.861 0.393 21.34 1.838 30.821l1.332 8.74 9.16-0.015z m144.696-588.992c-0.672 4.889-1.059 9.864-1.059 14.764 0 23.068 4.289 44.08 11.899 62.764 8.12 19.954 20.07 37.343 34.625 51.772a164.731 164.731 0 0 0 25.659 20.708c9.27 6.056 19.233 11.228 29.651 15.409 10.413 4.169 21.146 7.346 31.969 9.44a174.278 174.278 0 0 0 33.01 3.139c20.674 0 41.462-3.715 61.151-11.458 18.625-7.328 36.321-18.254 52.06-33.042 12.771-12.003 23.326-25.639 31.464-40.276l0.013 0.006c8.239-14.857 14.021-30.764 17.086-47.077 3.049-16.207 3.473-32.887 1.078-49.434-2.316-16.076-7.291-32.012-15.042-47.253-8.724-17.163-19.797-31.908-32.502-44.194-13.333-12.889-28.546-23.088-44.825-30.579a167.663 167.663 0 0 0-35.179-11.676 174.938 174.938 0 0 0-37.485-3.831c-12.404 0.067-24.945 1.519-37.288 4.301-12.16 2.748-23.984 6.776-35.145 12.064-16.196 7.666-31.303 18.042-44.524 31.049-12.494 12.294-23.318 27.04-31.776 44.16-2.092 4.254-4.283 9.42-6.328 15.163-1.984 5.567-3.792 11.423-5.227 17.206-1.362 5.522-2.518 11.225-3.285 16.875z m309.783 178.365c-2.765 2.487-5.936 5.481-9.742 9.367h-0.036l-10.793 11.004 14.599 5.512c6.807 2.573 14.399 5.819 22.289 9.469a451.15 451.15 0 0 1 23.717 11.861c7.666 4.111 14.997 8.35 21.568 12.433 6.391 3.969 12.294 7.999 17.37 11.862l10.401 7.938-0.126 0.098a586.845 586.845 0 0 1 9.322 7.589c6.021 5.016 11.574 9.908 16.874 14.883a396.137 396.137 0 0 1 16.016 15.881c5.329 5.602 10.674 11.497 16.23 17.884l-0.028 0.017a314.07 314.07 0 0 1 28.957 38.987v0.037a340.038 340.038 0 0 1 23.322 43.889 362.215 362.215 0 0 1 17.195 47.988h0.013c4.519 16.063 8.113 33.072 10.621 50.98 0.729 5.187 1.494 16.401 2.121 30.174a1572.346 1572.346 0 0 1 1.347 45.176c0.18 12.298 0.204 23.933 0.005 32.881-0.191 8.577-0.627 15.103-1.352 18.104h-0.009c-0.68 2.813-1.941 5.504-3.647 7.938v0.04a26.698 26.698 0 0 1-6.171 6.213h-0.05c-2.662 1.905-5.72 3.432-8.992 4.466h-0.032a34.82 34.82 0 0 1-9.966 1.543c-73.444 0.956-150.951 0.618-227.396 0.297l-2.878-0.021-10.85-0.049c-34.916-0.143-67.445-0.297-94.641-0.33v0.024h-10.595l-343.107 0.054v0.04c-4.116 0-7.877-0.391-11.236-1.147-3.764-0.847-7.126-2.231-9.994-4.096l-0.006 0.012a23.394 23.394 0 0 1-6.583-6.432c-1.61-2.337-2.88-5.064-3.739-8.077l-0.417-1.433v-0.521c-0.558-3.248-0.926-8.577-1.113-15.258-0.254-8.508-0.291-19.821-0.188-31.933 0.132-15.478 0.568-31.708 1.112-45.236 0.576-14.049 1.309-25.569 2.027-30.857l1.222-8.903h0.128a384.427 384.427 0 0 1 9.227-41.996c4.743-17.008 10.521-33.153 17.114-48.31h0.049c6.855-15.718 14.653-30.512 23.167-44.223 8.875-14.281 18.513-27.422 28.666-39.252 10.224-11.908 20.116-22.464 30.062-32.043 9.984-9.619 19.887-18.111 30.137-25.883 10.259-7.784 21.145-15.046 33.01-22.146 11.718-7.015 24.242-13.769 37.976-20.642l2.313-1.161h0.138a140.18 140.18 0 0 1 4.132-1.852 176.504 176.504 0 0 1 5.724-2.347l0.006 0.012 0.328-0.126c3.762-1.508 7.501-2.996 11.403-4.889l11.725-5.711-8.289-9.844c-1.565-1.864-3.133-3.448-4.759-4.954h-0.049c-1.527-1.423-3.807-3.359-6.312-5.488l0.024-0.024c-4.246-3.583-9.365-7.951-14.945-13.487a169.717 169.717 0 0 1-17.979-20.963c-14.141-19.463-24.487-39.666-31.383-60-7.272-21.488-10.733-43.258-10.768-64.626a202.581 202.581 0 0 1 6.424-50.913c4.344-16.854 10.813-33.136 19.132-48.394 8.264-15.168 18.415-29.417 30.153-42.321a220.148 220.148 0 0 1 39.494-34.172 220.384 220.384 0 0 1 59.727-28.429c20.625-6.249 42.859-9.685 66.238-9.728 24.406-0.037 47.354 3.531 68.511 10.073 22.394 6.921 42.826 17.163 60.893 29.942 14.188 10.031 27.015 21.712 38.291 34.642 11.488 13.189 21.316 27.613 29.254 42.818v0.041c7.938 15.235 14.078 31.34 18.206 47.876 4.087 16.347 6.24 33.208 6.273 50.156 0.036 21.538-3.343 43.234-10.454 64.276-6.795 20.074-17.001 39.608-30.899 57.905-6.969 9.16-11.997 15.046-16.165 19.368-4.291 4.445-7.649 7.234-11.265 10.236-2.178 1.795-4.491 3.715-7.299 6.231z"
                fill="#707070" p-id="11764"></path>
          </svg>
          <span>暂无粉丝哦！</span>
        </div>
      </el-scrollbar>
    </el-dialog>
  </div>
</template>

<style scoped>
#fansFM >>> .el-dialog {
  border-radius: 20px;
  min-height: 700px;
  background-color: #ffffff;
}

#fansFM >>> .el-dialog__body {
  padding: 20px 0;
  max-height: 650px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}

/*标题*/
#fansFM >>> .el-dialog__title {
  font-size: 25px;
  font-family: STXihei, serif;
  font-weight: 900;
  color: #e58c43;
}


.fanList {
  width: 100%;
  display: flex;
  padding: 10px 20px;
  cursor: pointer;
  transition: all 0.5s ease-in-out;
}

.fanList:hover {
  background-color: rgba(196, 196, 196, 0.65);
  border-radius: 13px;
  transition: all 0.5s ease-in-out;
}

.fAvatar img {
  height: 80px;
  width: 80px;
  border-radius: 50%;
}

.fNameAndfIntro {
  margin-left: 20px;
  display: flex;
  flex-direction: column;
  justify-content: center;
}

.fNameAndfIntro span {
  font-family: STXihei, serif;
  color: #414141;
}

.fIntro {
  font-family: STXihei, serif;
  color: rgba(0, 0, 0, 0.6) !important;
  font-size: 12px;
  white-space: nowrap; /*强制单行显示*/
  text-overflow: ellipsis; /*超出部分省略号表示*/
  overflow: hidden; /*超出部分隐藏*/
  width: 250px; /*设置显示的最大宽度*/
  display: inline-block;
}

#followBT {
  display: flex;
  align-items: center;
  margin-left: 20px;
}

#followBT >>> .el-button--danger.is-link, .el-button--danger.is-plain, .el-button--danger.is-text {
  min-width: 87px;
}



/*登录用户自己不能出现关注按钮*/
.noFollowBT {
  min-width: 87px;
  margin-left: 20px;
}

.noFan {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center
}

.noFan span {
  font-family: STXihei, serif;
  font-size: larger;
}
</style>